# âš¡ ZMongo Retriever

**ZMongo Retriever** is a high-performance, async-first MongoDB toolkit built for AI-powered and real-time applications.  
It wraps Motor with a modern async repository, true bulk optimizations, blazing-fast in-memory caching (not Redis), and seamless integration with OpenAI and local LLaMA models.

---

## ğŸš€ Features

- âœ… **100% test coverage** for all core modules (`zmongo_toolbag`)
- âš¡ **Async-enabled MongoDB access** using Motor
- ğŸ’¾ **Smart in-memory auto-caching** (no Redis needed)
- ğŸ”— **Seamless embedding integration** with OpenAI or local LLaMA (llama-cpp-python)
- ğŸ“ˆ **Bulk write optimizations** â€” now up to **140,000+ ops/sec**!
- ğŸ§ª **Benchmarks** comparing Mongo, Redis, and ZMongo (see below)
- ğŸ§  **Recursive-safe metadata flattening**
- âš–ï¸ **Legal text summarization + NLP preprocessing**
- ğŸ›¡ï¸ **SafeResult**: Universal JSON serialization for all Mongo results
- ğŸ”¥ **Agent-native**: Designed for the ZAI Core Fleet (chat, embedding, database, web, file, agent maker)

---

## ğŸ“¦ Installation

**From Source:**

```bash
git clone https://github.com/CentralFloridaAttorney/zmongo_retriever.git
cd zmongo_retriever
pip install .
````

**From PyPI:**

```bash
pip install --upgrade pip setuptools wheel
pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple zmongo_retriever==0.1.5
```

### Requirements

* Python 3.10+
* MongoDB (local or remote)
* OpenAI API Key or GGUF LLaMA Model (for embeddings)
* `llama-cpp-python` (if using local models)
* **Redis is not required** â€” ZMongo uses local in-memory caching for performance.

---

## âš™ï¸ Example `.env`

```env
MONGO_URI=mongodb://127.0.0.1:27017
MONGO_DATABASE_NAME=ztarot
OPENAI_API_KEY=your-api-key-here
OPENAI_TEXT_MODEL=gpt-3.5-turbo-instruct
DEFAULT_MAX_TOKENS=256
DEFAULT_TEMPERATURE=0.7
DEFAULT_TOP_P=0.95
GGUF_MODEL_PATH=/path/to/your/model.gguf
```

---

## ğŸ”§ Quickstart

### Async Mongo Access

```python
from zmongo_toolbag.zmongo import ZMongo
import asyncio

async def main():
    mongo = ZMongo()
    await mongo.insert_document("users", {"name": "Alice"})
    user = await mongo.find_document("users", {"name": "Alice"})
    print(user.model_dump())

asyncio.run(main())
```

### Bulk Insert (True Async, High Speed)

```python
from zmongo_toolbag.zmongo import ZMongo
import asyncio

async def main():
    zmongo = ZMongo()
    docs = [{"x": i} for i in range(100_000)]
    result = await zmongo.insert_documents("bulk_test", docs)
    print(result.model_dump())

asyncio.run(main())
```

### Built-in Caching (not Redis)

```python
await mongo.find_document("collection", {"field": "value"})  # âœ¨ Cached in memory
await mongo.delete_document("collection", {"field": "value"})  # âŒ Cache invalidated
```

### Use with OpenAI GPT

```python
from zmongo_toolbag.zmongo import ZMongo
from zmongo_toolbag.zmongo_embedder import ZMongoEmbedder
import asyncio

async def main():
    embedder = ZMongoEmbedder(collection="documents")
    doc_id = ...  # your ObjectId here
    await embedder.embed_and_store(doc_id, "Your text to embed")

asyncio.run(main())
```

### Use with LLaMA (local)

```python
from zmongo_toolbag.zmongo import ZMongo
from zai_toolbag.llama_model import LlamaModel
import asyncio
from datetime import datetime

async def main():
    zmongo = ZMongo()
    llama_model = LlamaModel()

    user_input = "Write a Dungeons & Dragons encounter using D20 rules..."
    prompt = llama_model.generate_prompt_from_template(user_input)
    output_text = llama_model.generate_text(prompt=prompt, max_tokens=3000)

    doc = {
        "type": "dnd_encounter",
        "prompt": user_input,
        "generated": output_text,
        "timestamp": datetime.now(),
        "model": "llama_model"
    }
    saved_doc = await zmongo.insert_document("dnd_encounters", doc)
    print("\nâœ… Saved to MongoDB:", saved_doc.model_dump())

    await zmongo.close()

asyncio.run(main())
```

---

## ğŸ“ˆ Real-World Benchmark Comparison

**April 2025 Murder Mystery Suite (N=10,000):**

| Operation      | ZMongo (Async/Bulk) | ZMongo (Sync/Legacy) | PyMongo  | MongoEngine | SQLAlchemy | Mongo Shell | Redis  |
| -------------- | ------------------- | -------------------- | -------- | ----------- | ---------- | ----------- | ------ |
| Bulk Insert    | **142,844/sec**     | 4,000â€“8,000/sec      | 30â€“80k   | 20â€“50k      | 30â€“120k    | 204,995     | 17,956 |
| Per-Doc Insert | 3,079/sec           | 1,000â€“2,000/sec      | 2â€“5k     | 0.8â€“2k      | 1.5â€“6k     | 25â€“60k      | 5â€“20k  |
| Bulk Find      | **76,915/sec**      | 2,000â€“5,000/sec      | 10â€“40k   | 10â€“20k      | 10â€“70k     | 180,000     | 50,000 |
| Per-Doc Find   | 501/sec             | 400â€“900/sec          | 500â€“3k   | 800â€“1.5k    | 800â€“4k     | 5â€“10k       | 10â€“20k |
| Bulk Delete    | **40,009/sec**      | 2,000â€“5,000/sec      | 10â€“50k   | 10â€“30k      | 15â€“70k     | 120,000     | 12,000 |
| Per-Doc Delete | 3,668/sec           | 1,000â€“2,000/sec      | 2â€“5k     | 1â€“2.5k      | 1â€“4k       | 25â€“60k      | 5â€“20k  |
| Bulk Lookup    | 201/sec             | 50â€“150/sec           | 150â€“1.5k | 80â€“800      | 200â€“2k     | 5â€“12k       | n/a    |

> ZMongoâ€™s async/bulk architecture is now up to **30x faster** than the prior version and outpaces most other Python-native wrappers.

---

## ğŸ† Use Case Suitability

| Use Case              | ZMongo âœ… | Why                                                  |
| --------------------- | -------- | ---------------------------------------------------- |
| LLM/AI Workflows      | âœ…âœ…âœ…      | Fast cached reads, embedding support, async-native   |
| Async Web Servers     | âœ…âœ…       | Integrates with asyncio, high concurrent performance |
| LegalTech / NLP Tools | âœ…âœ…       | Metadata/flattening, optimized for text, summaries   |
| Edge AI & Agents      | âœ…âœ…       | In-memory perf, agent orchestration                  |
| Bulk ETL Ingestion    | ğŸŸ¡       | Batch ops support, Mongo shell is still fastest      |
| Analytics Dashboards  | ğŸŸ¡âœ…      | Great for caching reads, Redis faster for pub/sub    |

---

## ğŸ§ª Run Tests

```bash
PYTHONPATH=.. python -m unittest discover tests
```

## ğŸ§ª Run Benchmarks

```bash
PYTHONPATH=. python tests/test_real_db_comparative_benchmarks.py
PYTHONPATH=. python tests/test_zmongo_comparative_benchmarks.py
```

---

## ğŸ“Œ Roadmap

* Add optional Redis backend (future)
* LLaMA summarization pipelines from Mongo text
* Full schema validation layer for stored documents
* Aggregation/lookup speed improvements

---

## ğŸ§‘â€ğŸ’¼ Author

Crafted by **John M. Iriye**

Contact: [Contact@CentralFloridaAttorney.net](mailto:Contact@CentralFloridaAttorney.net)
ğŸŒ [View Project on GitHub](https://github.com/CentralFloridaAttorney/zmongo_retriever)

â­ï¸ *Star this repo if it saved you time or effort!*

---

## ğŸ“„ License

MIT License â€“ see LICENSE for full terms.

---
